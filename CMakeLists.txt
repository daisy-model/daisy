cmake_minimum_required(VERSION 3.25)
project(
  daisy
  VERSION 6.44
  LANGUAGES CXX)

set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED True)

set(COMPILER_WARNINGS
  -Wpedantic
  -Wall
  -Wextra
  -Wvariadic-macros 
  -Wvla
  -Wmissing-declarations
  -Wfloat-equal
  -Wcast-qual
  -Woverloaded-virtual
  -Wundef
  -Wpointer-arith
  -Wwrite-strings
  -Wcast-align
  -Wmissing-format-attribute
  -Wold-style-cast
  -Wformat=2
  -Winit-self
  -Wsign-promo
  -Wredundant-decls
  -Wno-unused-parameter
  -Wno-sign-compare
  -Wno-mismatched-tags
)

set(RELEASE_COMPILE_OPTIONS
  -ffast-math
  -fno-finite-math-only
  -mtune=native
  -march=native
) 

find_package(Boost 1.74 COMPONENTS filesystem REQUIRED)
message(STATUS "Boost version: ${Boost_VERSION}")

add_executable(daisy
  gnuplot_multi.C
  gnuplot_profile.C
  gnuplot_soil.C
  gnuplot_time.C
  gnuplot_vector.C
  gnuplot_xy.C
  source.C
  source_combine.C
  source_expr.C
  source_file.C
  source_merge.C
  source_std.C
  xysource.C
  xysource_combine.C
  xysource_expr.C
  xysource_flux.C
  xysource_freq.C
  xysource_inline.C
  xysource_loop.C
  xysource_merge.C
  xysource_profile.C
  xysource_xycombine.C
  gnuplot.C
  gnuplot_base.C
  gnuplot_utils.C
  program_gnuplot.C
  ABAprod.C
  ABAprod_root.C
  ABAprod_soil.C
  ABAprod_uptake.C
  GP2D.C
  abiotic.C
  action.C
  action_BBCH.C
  action_activity.C
  action_crop.C
  action_extern.C
  action_fertilize.C
  action_harvest.C
  action_irrigate.C
  action_lisp.C
  action_markvand.C
  action_message.C
  action_repeat.C
  action_sow.C
  action_spray.C
  action_stop.C
  action_surface.C
  action_table.C
  action_tillage.C
  action_wait.C
  action_while.C
  action_with.C
  adsorption.C
  adsorption_freundlich.C
  adsorption_langmuir.C
  adsorption_linear.C
  adsorption_vS_S.C
  am.C
  anystate.C
  aom.C
  assertion.C
  astronomy.C
  attribute.C
  average.C
  bdconv.C
  bioclimate.C
  bioclimate_std.C
  bioincorporation.C
  biopore.C
  biopore_drain.C
  biopore_matrix.C
  block.C
  block_model.C
  block_nested.C
  block_submodel.C
  block_top.C
  boolean.C
  boolean_number.C
  boolean_string.C
  border.C
  bound.C
  canopy_simple.C
  canopy_std.C
  check.C
  check_range.C
  chemical.C
  chemical_std.C
  chemistry.C
  chemistry_multi.C
  chemistry_std.C
  clayom.C
  clayom_biomod.C
  clayom_old.C
  cloudiness.C
  column.C
  column_std.C
  complex_functions.C
  condedge.C
  condition.C
  condition_BBCH.C
  condition_boolean.C
  condition_crop.C
  condition_daisy.C
  condition_extern.C
  condition_logic.C
  condition_soil.C
  condition_time.C
  condition_walltime.C
  condition_weather.C
  convert.C
  crop.C
  crop_simple.C
  crop_std.C
  crpn.C
  cstage.C
  daisy.C
  daisy_time.C
  deposition.C
  depth.C
  destination.C
  difrad.C
  difrad_DPF.C
  difrad_weather.C
  dlf.C
  doe.C
  dom.C
  domsorp.C
  domsorp_std.C
  drain.C
  drain_lateral.C
  draineqd.C
  #element.C
  equil.C
  equil_goal.C
  equil_langmuir.C
  equil_linear.C
  fao.C
  fetch.C
  fetch_pretty.C
  field.C
  filepos.C
  format.C
  format_LaTeX.C
  frame.C
  frame_model.C
  frame_submodel.C
  function.C
  gaussj.C
  geometry.C
  geometry1d.C
  geometry_rect.C
  geometry_vert.C
  ghf.C
  groundwater.C
  groundwater_aquitard.C
  groundwater_deep.C
  groundwater_extern.C
  groundwater_file.C
  groundwater_fixed.C
  groundwater_flux.C
  groundwater_lysimeter.C
  groundwater_source.C
  groundwater_static.C
  harvest.C
  harvesting.C
  heatrect.C
  heatrect_Mollerup.C
  heatrect_linear.C
  heatrect_none.C
  horheat.C
  horizon.C
  horizon_numeric.C
  horizon_system.C
  hydraulic.C
  hydraulic_B_BaC.C
  hydraulic_B_BaC_Bimodal.C
  hydraulic_B_C.C
  hydraulic_B_C_inverse.C
  hydraulic_B_vG.C
  hydraulic_Cosby.C
  hydraulic_MACRO.C
  hydraulic_M_BaC.C
  hydraulic_M_BaC_Bimodal.C
  hydraulic_M_BivG.C
  hydraulic_M_C.C
  hydraulic_M_vG.C
  hydraulic_M_vG_compact.C
  hydraulic_M_vGip.C
  hydraulic_M_vGp.C
  hydraulic_hypres.C
  hydraulic_hyprop.C
  hydraulic_linear.C
  hydraulic_mod_C.C
  hydraulic_old2.C
  hydraulic_table.C
  hydraulic_wepp.C
  hydraulic_yolo.C
  hyp_2F1.C
  im.C
  imvec.C
  integer.C
  integer_arit.C
  intrinsics.C
  irrigate.C
  iterative.C
  lexer.C
  lexer_data.C
  lexer_flux.C
  lexer_soil.C
  lexer_table.C
  librarian.C
  library.C
  litter.C
  litter_mulch.C
  litter_residue.C
  log.C
  log_alist.C
  log_all.C
  log_checkpoint.C
  log_extern.C
  log_harvest.C
  log_select.C
  log_table.C
  macro.C
  macro_none.C
  macro_std.C
  mactrans.C
  mactrans_std.C
  main.C
  mathlib.C
  metalib.C
  model.C
  model_derived.C
  model_framed.C
  model_logable.C
  movement.C
  movement_1D.C
  movement_rect.C
  movement_solute.C
  net_radiation.C
  nitrification.C
  nitrification_soil.C
  nitrification_solute.C
  nrutil.C
  number.C
  number_arit.C
  number_const.C
  number_lisp.C
  number_plf.C
  number_soil.C
  number_source.C
  oldunits.C
  om.C
  organic.C
  organic_none.C
  organic_std.C
  output.C
  parser.C
  parser_file.C
  partition.C
  path.C
  pet.C
  pet_FAO_PM.C
  pet_FAO_PM_hourly.C
  pet_Hargreaves.C
  pet_PM.C
  pet_makkink.C
  pet_weather.C
  phenology.C
  phenology_TSum.C
  phenology_std.C
  photo.C
  photo_FCC3.C
  photo_FCC4.C
  photo_Farquhar.C
  photo_GL.C
  plf.C
  point.C
  ponddamp.C
  printer.C
  printer_file.C
  production.C
  program.C
  program_GP2D.C
  program_KM2.C
  program_batch.C
  program_cpedata.C
  program_document.C
  program_extract.C
  program_file.C
  program_hmovie.C
  program_nwaps.C
  program_optimize.C
  program_osvaldo.C
  program_post.C
  program_rootmatch.C
  program_sbrdata.C
  program_spawn.C
  program_weather.C
  raddist.C
  raddist_DPF.C
  raddist_std.C
  rainergy.C
  rate.C
  reaction.C
  reaction_Jarvis99.C
  reaction_Morgan98.C
  reaction_Styczen88.C
  reaction_adsorption.C
  reaction_boundrel.C
  reaction_colgen.C
  reaction_denit.C
  reaction_dom.C
  reaction_equil.C
  reaction_filter.C
  reaction_nit.C
  reaction_shoot.C
  reaction_sorption.C
  reaction_std.C
  resistance.C
  retention.C
  root_system.C
  rootdens.C
  rootdens_AP.C
  rootdens_GP1D.C
  rootdens_GP2D.C
  rootdens_G_P.C
  rootdens_PLF.C
  rootdens_growth.C
  rootdens_local.C
  rubiscoN.C
  rubiscoNdist.C
  rubiscoNdist_DPF.C
  rubiscoNdist_expr.C
  rubiscoNdist_forced.C
  rubiscoNdist_uniform.C
  run.C
  scope.C
  scope_exchange.C
  scope_id.C
  scope_model.C
  scope_multi.C
  scope_soil.C
  scope_sources.C
  scope_table.C
  scope_xysources.C
  scopesel.C
  secondary.C
  seed.C
  seed_LAI.C
  seed_release.C
  select.C
  select_array.C
  select_content.C
  select_flow.C
  select_index.C
  select_number.C
  select_quiver.C
  select_value.C
  select_volume.C
  smb.C
  snow.C
  soil.C
  soil_heat.C
  soil_water.C
  soilph.C
  solupt.C
  solver.C
  solver_cxsparse.C
  solver_none.C
  solver_ublas.C
  som.C
  stomatacon.C
  stomatacon_SHA.C
  stringer.C
  summary.C
  summary_Rsqr.C
  summary_RsqrW.C
  summary_balance.C
  summary_fractiles.C
  summary_simple.C
  surface.C
  surface_simple.C
  surface_source.C
  surface_std.C
  svat.C
  svat_none.C
  svat_pmsw.C
  svat_ssoc.C
  symbol.C
  tertiary.C
  tertiary_biopores.C
  tertiary_old.C
  texture.C
  timestep.C
  toplevel.C
  tortuosity.C
  tortuosity_M_Q.C
  tortuosity_linear.C
  transform.C
  transform_equil.C
  transport.C
  transport_Hansen.C
  transport_Mollerup.C
  transport_convection.C
  transport_none.C
  traverse.C
  traverse_delete.C
  treelog.C
  treelog_child.C
  treelog_store.C
  treelog_text.C
  type.C
  ui.C
  uifilter.C
  unit.C
  unit_model.C
  units.C
  uz1d.C
  uz1d_none.C
  uz1d_richard.C
  uzlr.C
  uzmodel.C
  uznone.C
  uzrect.C
  uzrect_2x1.C
  uzrect_Mollerup.C
  uzrect_const.C
  uzrichard.C
  uzrichard2.C
  value.C
  vcheck.C
  vegetation.C
  vegetation_afforestation.C
  vegetation_crops.C
  vegetation_permanent.C
  vernalization.C
  version.C
  volume.C
  volume_box.C
  water.C
  weather.C
  weatherdata.C
  wse.C
  wsource.C
  wsource_base.C
  wsource_combine.C
  wsource_const.C
  wsource_indirect.C
  wsource_std.C
  wsource_table.C
  wsource_time.C
  wsource_weather.C
  xref.C
  zone.C
  zone_box.C
  zone_poly.C
)

target_include_directories(daisy PRIVATE
  include
)

target_link_directories(daisy PRIVATE
  ${Boost_INCLUDE_DIR}
)

target_compile_options(daisy PRIVATE ${COMPILER_WARNINGS})

target_compile_options(daisy PRIVATE
  "$<$<CONFIG:RELEASE>:${RELEASE_COMPILE_OPTIONS}>"
)

target_link_libraries(daisy PUBLIC
  stdc++
  ${Boost_LIBRARIES}
  cxsparse
  dl
  pthread  
)
