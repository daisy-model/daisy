cmake_minimum_required(VERSION 3.25)
project(
  daisy
  VERSION 6.44
  LANGUAGES CXX)

set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED True)

add_compile_options(
  -Wpedantic
  -Wall
  -Wextra
  -Wvariadic-macros 
  -Wvla
  -Wmissing-declarations
  -Wfloat-equal
  -Wcast-qual
  -Woverloaded-virtual
  -Wundef
  -Wpointer-arith
  -Wwrite-strings
  -Wcast-align
  -Wmissing-format-attribute
  -Wold-style-cast
  -Wformat=2
  -Winit-self
  -Wsign-promo
  -Wredundant-decls
  -Wno-unused-parameter
  -Wno-sign-compare
  -Wno-mismatched-tags
)

find_package(Boost 1.74 REQUIRED CONFIG COMPONENTS filesystem system)
message(STATUS "Boost version: ${Boost_VERSION}")

add_subdirectory(src)

add_executable(daisy
  src/ABAprod.C
  src/ABAprod_root.C
  src/ABAprod_soil.C
  src/ABAprod_uptake.C
  src/GP2D.C
  src/abiotic.C
  src/action.C
  src/action_BBCH.C
  src/action_activity.C
  src/action_crop.C
  src/action_extern.C
  src/action_fertilize.C
  src/action_harvest.C
  src/action_irrigate.C
  src/action_lisp.C
  src/action_markvand.C
  src/action_message.C
  src/action_repeat.C
  src/action_sow.C
  src/action_spray.C
  src/action_stop.C
  src/action_surface.C
  src/action_table.C
  src/action_tillage.C
  src/action_wait.C
  src/action_while.C
  src/action_with.C
  src/adsorption.C
  src/adsorption_freundlich.C
  src/adsorption_langmuir.C
  src/adsorption_linear.C
  src/adsorption_vS_S.C
  src/am.C
  src/anystate.C
  src/aom.C
  src/assertion.C
  src/astronomy.C
  src/attribute.C
  src/average.C
  src/bdconv.C
  src/bioclimate.C
  src/bioclimate_std.C
  src/bioincorporation.C
  src/biopore.C
  src/biopore_drain.C
  src/biopore_matrix.C
  src/block.C
  src/block_model.C
  src/block_nested.C
  src/block_submodel.C
  src/block_top.C
  src/boolean.C
  src/boolean_number.C
  src/boolean_string.C
  src/border.C
  src/bound.C
  src/canopy_simple.C
  src/canopy_std.C
  src/check.C
  src/check_range.C
  src/chemical.C
  src/chemical_std.C
  src/chemistry.C
  src/chemistry_multi.C
  src/chemistry_std.C
  src/clayom.C
  src/clayom_biomod.C
  src/clayom_old.C
  src/cloudiness.C
  src/column.C
  src/column_std.C
  src/complex_functions.C
  src/condedge.C
  src/condition.C
  src/condition_BBCH.C
  src/condition_boolean.C
  src/condition_crop.C
  src/condition_daisy.C
  src/condition_extern.C
  src/condition_logic.C
  src/condition_soil.C
  src/condition_time.C
  src/condition_walltime.C
  src/condition_weather.C
  src/convert.C
  src/crop.C
  src/crop_simple.C
  src/crop_std.C
  src/crpn.C
  src/cstage.C
  src/daisy.C
  src/daisy_time.C
  src/deposition.C
  src/depth.C
  src/destination.C
  src/difrad.C
  src/difrad_DPF.C
  src/difrad_weather.C
  src/dlf.C
  src/doe.C
  src/dom.C
  src/domsorp.C
  src/domsorp_std.C
  src/drain.C
  src/drain_lateral.C
  src/draineqd.C
  src/#element.C
  src/equil.C
  src/equil_goal.C
  src/equil_langmuir.C
  src/equil_linear.C
  src/fao.C
  src/fetch.C
  src/fetch_pretty.C
  src/field.C
  src/filepos.C
  src/format.C
  src/format_LaTeX.C
  src/frame.C
  src/frame_model.C
  src/frame_submodel.C
  src/function.C
  src/gaussj.C
  src/geometry.C
  src/geometry1d.C
  src/geometry_rect.C
  src/geometry_vert.C
  src/ghf.C
  src/groundwater.C
  src/groundwater_aquitard.C
  src/groundwater_deep.C
  src/groundwater_extern.C
  src/groundwater_file.C
  src/groundwater_fixed.C
  src/groundwater_flux.C
  src/groundwater_lysimeter.C
  src/groundwater_source.C
  src/groundwater_static.C
  src/harvest.C
  src/harvesting.C
  src/heatrect.C
  src/heatrect_Mollerup.C
  src/heatrect_linear.C
  src/heatrect_none.C
  src/horheat.C
  src/horizon.C
  src/horizon_numeric.C
  src/horizon_system.C
  src/hydraulic.C
  src/hydraulic_B_BaC.C
  src/hydraulic_B_BaC_Bimodal.C
  src/hydraulic_B_C.C
  src/hydraulic_B_C_inverse.C
  src/hydraulic_B_vG.C
  src/hydraulic_Cosby.C
  src/hydraulic_MACRO.C
  src/hydraulic_M_BaC.C
  src/hydraulic_M_BaC_Bimodal.C
  src/hydraulic_M_BivG.C
  src/hydraulic_M_C.C
  src/hydraulic_M_vG.C
  src/hydraulic_M_vG_compact.C
  src/hydraulic_M_vGip.C
  src/hydraulic_M_vGp.C
  src/hydraulic_hypres.C
  src/hydraulic_hyprop.C
  src/hydraulic_linear.C
  src/hydraulic_mod_C.C
  src/hydraulic_old2.C
  src/hydraulic_table.C
  src/hydraulic_wepp.C
  src/hydraulic_yolo.C
  src/hyp_2F1.C
  src/im.C
  src/imvec.C
  src/integer.C
  src/integer_arit.C
  src/intrinsics.C
  src/irrigate.C
  src/iterative.C
  src/lexer.C
  src/lexer_data.C
  src/lexer_flux.C
  src/lexer_soil.C
  src/lexer_table.C
  src/librarian.C
  src/library.C
  src/litter.C
  src/litter_mulch.C
  src/litter_residue.C
  src/log.C
  src/log_alist.C
  src/log_all.C
  src/log_checkpoint.C
  src/log_extern.C
  src/log_harvest.C
  src/log_select.C
  src/log_table.C
  src/macro.C
  src/macro_none.C
  src/macro_std.C
  src/mactrans.C
  src/mactrans_std.C
  src/main.C
  src/mathlib.C
  src/metalib.C
  src/model.C
  src/model_derived.C
  src/model_framed.C
  src/model_logable.C
  src/movement.C
  src/movement_1D.C
  src/movement_rect.C
  src/movement_solute.C
  src/net_radiation.C
  src/nitrification.C
  src/nitrification_soil.C
  src/nitrification_solute.C
  src/nrutil.C
  src/number.C
  src/number_arit.C
  src/number_const.C
  src/number_lisp.C
  src/number_plf.C
  src/number_soil.C
  src/number_source.C
  src/oldunits.C
  src/om.C
  src/organic.C
  src/organic_none.C
  src/organic_std.C
  src/output.C
  src/parser.C
  src/parser_file.C
  src/partition.C
  src/path.C
  src/pet.C
  src/pet_FAO_PM.C
  src/pet_FAO_PM_hourly.C
  src/pet_Hargreaves.C
  src/pet_PM.C
  src/pet_makkink.C
  src/pet_weather.C
  src/phenology.C
  src/phenology_TSum.C
  src/phenology_std.C
  src/photo.C
  src/photo_FCC3.C
  src/photo_FCC4.C
  src/photo_Farquhar.C
  src/photo_GL.C
  src/plf.C
  src/point.C
  src/ponddamp.C
  src/printer.C
  src/printer_file.C
  src/production.C
  src/program.C
  src/program_GP2D.C
  src/program_KM2.C
  src/program_batch.C
  src/program_cpedata.C
  src/program_document.C
  src/program_extract.C
  src/program_file.C
  src/program_hmovie.C
  src/program_nwaps.C
  src/program_optimize.C
  src/program_osvaldo.C
  src/program_post.C
  src/program_rootmatch.C
  src/program_sbrdata.C
  src/program_spawn.C
  src/program_weather.C
  src/raddist.C
  src/raddist_DPF.C
  src/raddist_std.C
  src/rainergy.C
  src/rate.C
  src/reaction.C
  src/reaction_Jarvis99.C
  src/reaction_Morgan98.C
  src/reaction_Styczen88.C
  src/reaction_adsorption.C
  src/reaction_boundrel.C
  src/reaction_colgen.C
  src/reaction_denit.C
  src/reaction_dom.C
  src/reaction_equil.C
  src/reaction_filter.C
  src/reaction_nit.C
  src/reaction_shoot.C
  src/reaction_sorption.C
  src/reaction_std.C
  src/resistance.C
  src/retention.C
  src/root_system.C
  src/rootdens.C
  src/rootdens_AP.C
  src/rootdens_GP1D.C
  src/rootdens_GP2D.C
  src/rootdens_G_P.C
  src/rootdens_PLF.C
  src/rootdens_growth.C
  src/rootdens_local.C
  src/rubiscoN.C
  src/rubiscoNdist.C
  src/rubiscoNdist_DPF.C
  src/rubiscoNdist_expr.C
  src/rubiscoNdist_forced.C
  src/rubiscoNdist_uniform.C
  src/run.C
  src/scope.C
  src/scope_exchange.C
  src/scope_id.C
  src/scope_model.C
  src/scope_multi.C
  src/scope_soil.C
  src/scope_sources.C
  src/scope_table.C
  src/scope_xysources.C
  src/scopesel.C
  src/secondary.C
  src/seed.C
  src/seed_LAI.C
  src/seed_release.C
  src/select.C
  src/select_array.C
  src/select_content.C
  src/select_flow.C
  src/select_index.C
  src/select_number.C
  src/select_quiver.C
  src/select_value.C
  src/select_volume.C
  src/smb.C
  src/snow.C
  src/soil.C
  src/soil_heat.C
  src/soil_water.C
  src/soilph.C
  src/solupt.C
  src/solver.C
  src/solver_cxsparse.C
  src/solver_none.C
  src/solver_ublas.C
  src/som.C
  src/stomatacon.C
  src/stomatacon_SHA.C
  src/stringer.C
  src/summary.C
  src/summary_Rsqr.C
  src/summary_RsqrW.C
  src/summary_balance.C
  src/summary_fractiles.C
  src/summary_simple.C
  src/surface.C
  src/surface_simple.C
  src/surface_source.C
  src/surface_std.C
  src/svat.C
  src/svat_none.C
  src/svat_pmsw.C
  src/svat_ssoc.C
  src/symbol.C
  src/tertiary.C
  src/tertiary_biopores.C
  src/tertiary_old.C
  src/texture.C
  src/timestep.C
  src/toplevel.C
  src/tortuosity.C
  src/tortuosity_M_Q.C
  src/tortuosity_linear.C
  src/transform.C
  src/transform_equil.C
  src/transport.C
  src/transport_Hansen.C
  src/transport_Mollerup.C
  src/transport_convection.C
  src/transport_none.C
  src/traverse.C
  src/traverse_delete.C
  src/treelog.C
  src/treelog_child.C
  src/treelog_store.C
  src/treelog_text.C
  src/type.C
  src/ui.C
  src/uifilter.C
  src/unit.C
  src/unit_model.C
  src/units.C
  src/uz1d.C
  src/uz1d_none.C
  src/uz1d_richard.C
  src/uzlr.C
  src/uzmodel.C
  src/uznone.C
  src/uzrect.C
  src/uzrect_2x1.C
  src/uzrect_Mollerup.C
  src/uzrect_const.C
  src/uzrichard.C
  src/uzrichard2.C
  src/value.C
  src/vcheck.C
  src/vegetation.C
  src/vegetation_afforestation.C
  src/vegetation_crops.C
  src/vegetation_permanent.C
  src/vernalization.C
  src/version.C
  src/volume.C
  src/volume_box.C
  src/water.C
  src/weather.C
  src/weatherdata.C
  src/wse.C
  src/wsource.C
  src/wsource_base.C
  src/wsource_combine.C
  src/wsource_const.C
  src/wsource_indirect.C
  src/wsource_std.C
  src/wsource_table.C
  src/wsource_time.C
  src/wsource_weather.C
  src/xref.C
  src/zone.C
  src/zone_box.C
  src/zone_poly.C
)

target_include_directories(daisy PUBLIC include)

target_link_directories(daisy INTERFACE Boost::Boost)

target_link_libraries(daisy PRIVATE
  gnuplot
)

target_link_libraries(daisy PUBLIC
  stdc++
  ${Boost_LIBRARIES}
  cxsparse
  dl
  pthread  
)


set(RELEASE_COMPILE_OPTIONS
  -ffast-math
  -fno-finite-math-only
  -mtune=native
  -march=native
) 
target_compile_options(daisy PRIVATE
  "$<$<CONFIG:RELEASE>:${RELEASE_COMPILE_OPTIONS}>"
)
