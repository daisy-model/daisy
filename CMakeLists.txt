cmake_minimum_required(VERSION 3.25)
project(
  daisy
  VERSION 6.44
  LANGUAGES CXX)

set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED True)

add_compile_options(
  -Wpedantic
  -Wall
  -Wextra
  -Wvariadic-macros 
  -Wvla
  -Wmissing-declarations
  -Wfloat-equal
  -Wcast-qual
  -Woverloaded-virtual
  -Wundef
  -Wpointer-arith
  -Wwrite-strings
  -Wcast-align
  -Wmissing-format-attribute
  -Wold-style-cast
  -Wformat=2
  -Winit-self
  -Wsign-promo
  -Wredundant-decls
  -Wno-unused-parameter
  -Wno-sign-compare
  -Wno-mismatched-tags
)

find_package(Boost 1.74 REQUIRED CONFIG COMPONENTS filesystem system)
message(STATUS "Boost version: ${Boost_VERSION}")

# Compiling parts as libraries does not work, as daisy cannot find the models.
# TODO: Figure out why
# add_subdirectory(src) 

add_executable(daisy
  src/daisy/chemicals/adsorption.C
  src/daisy/chemicals/adsorption_freundlich.C
  src/daisy/chemicals/adsorption_langmuir.C
  src/daisy/chemicals/adsorption_linear.C
  src/daisy/chemicals/adsorption_vS_S.C
  src/daisy/chemicals/chemical.C
  src/daisy/chemicals/chemical_std.C
  src/daisy/chemicals/chemistry.C
  src/daisy/chemicals/chemistry_multi.C
  src/daisy/chemicals/chemistry_std.C
  src/daisy/chemicals/equil.C
  src/daisy/chemicals/equil_goal.C
  src/daisy/chemicals/equil_langmuir.C
  src/daisy/chemicals/equil_linear.C
  src/daisy/chemicals/im.C
  src/daisy/chemicals/imvec.C
  src/daisy/chemicals/nitrification.C
  src/daisy/chemicals/nitrification_soil.C
  src/daisy/chemicals/nitrification_solute.C
  src/daisy/chemicals/ponddamp.C
  src/daisy/chemicals/rainergy.C
  src/daisy/chemicals/reaction.C
  src/daisy/chemicals/reaction_Jarvis99.C
  src/daisy/chemicals/reaction_Morgan98.C
  src/daisy/chemicals/reaction_Styczen88.C
  src/daisy/chemicals/reaction_adsorption.C
  src/daisy/chemicals/reaction_boundrel.C
  src/daisy/chemicals/reaction_colgen.C
  src/daisy/chemicals/reaction_denit.C
  src/daisy/chemicals/reaction_dom.C
  src/daisy/chemicals/reaction_equil.C
  src/daisy/chemicals/reaction_filter.C
  src/daisy/chemicals/reaction_nit.C
  src/daisy/chemicals/reaction_shoot.C
  src/daisy/chemicals/reaction_sorption.C
  src/daisy/chemicals/reaction_std.C
  src/daisy/chemicals/transform.C
  src/daisy/chemicals/transform_equil.C
  src/daisy/column.C
  src/daisy/column_std.C
  src/daisy/condition.C
  src/daisy/condition_BBCH.C
  src/daisy/condition_boolean.C
  src/daisy/condition_crop.C
  src/daisy/condition_daisy.C
  src/daisy/condition_extern.C
  src/daisy/condition_logic.C
  src/daisy/condition_soil.C
  src/daisy/condition_time.C
  src/daisy/condition_walltime.C
  src/daisy/condition_weather.C
  src/daisy/crop/canopy_simple.C
  src/daisy/crop/canopy_std.C
  src/daisy/crop/crop.C
  src/daisy/crop/crop_simple.C
  src/daisy/crop/crop_std.C
  src/daisy/crop/crpn.C
  src/daisy/crop/cstage.C
  src/daisy/crop/harvesting.C
  src/daisy/crop/partition.C
  src/daisy/crop/phenology.C
  src/daisy/crop/phenology_TSum.C
  src/daisy/crop/phenology_std.C
  src/daisy/crop/photo.C
  src/daisy/crop/photo_FCC3.C
  src/daisy/crop/photo_FCC4.C
  src/daisy/crop/photo_Farquhar.C
  src/daisy/crop/photo_GL.C
  src/daisy/crop/production.C
  src/daisy/crop/root/ABAprod.C
  src/daisy/crop/root/ABAprod_root.C
  src/daisy/crop/root/ABAprod_soil.C
  src/daisy/crop/root/ABAprod_uptake.C
  src/daisy/crop/root/GP2D.C
  src/daisy/crop/root/root_system.C
  src/daisy/crop/root/rootdens.C
  src/daisy/crop/root/rootdens_AP.C
  src/daisy/crop/root/rootdens_GP1D.C
  src/daisy/crop/root/rootdens_GP2D.C
  src/daisy/crop/root/rootdens_G_P.C
  src/daisy/crop/root/rootdens_PLF.C
  src/daisy/crop/root/rootdens_growth.C
  src/daisy/crop/root/rootdens_local.C
  src/daisy/crop/root/rubiscoN.C
  src/daisy/crop/root/rubiscoNdist.C
  src/daisy/crop/root/rubiscoNdist_DPF.C
  src/daisy/crop/root/rubiscoNdist_expr.C
  src/daisy/crop/root/rubiscoNdist_forced.C
  src/daisy/crop/root/rubiscoNdist_uniform.C
  src/daisy/crop/root/solupt.C
  src/daisy/crop/seed.C
  src/daisy/crop/seed_LAI.C
  src/daisy/crop/seed_release.C
  src/daisy/crop/stomatacon.C
  src/daisy/crop/stomatacon_SHA.C
  src/daisy/crop/vernalization.C
  src/daisy/crop/wse.C
  src/daisy/daisy.C
  src/daisy/daisy_time.C
  src/daisy/field.C
  src/daisy/lower_boundary/groundwater.C
  src/daisy/lower_boundary/groundwater_aquitard.C
  src/daisy/lower_boundary/groundwater_deep.C
  src/daisy/lower_boundary/groundwater_extern.C
  src/daisy/lower_boundary/groundwater_file.C
  src/daisy/lower_boundary/groundwater_fixed.C
  src/daisy/lower_boundary/groundwater_flux.C
  src/daisy/lower_boundary/groundwater_lysimeter.C
  src/daisy/lower_boundary/groundwater_source.C
  src/daisy/lower_boundary/groundwater_static.C
  src/daisy/manager/action.C
  src/daisy/manager/action_BBCH.C
  src/daisy/manager/action_activity.C
  src/daisy/manager/action_crop.C
  src/daisy/manager/action_extern.C
  src/daisy/manager/action_fertilize.C
  src/daisy/manager/action_harvest.C
  src/daisy/manager/action_irrigate.C
  src/daisy/manager/action_lisp.C
  src/daisy/manager/action_markvand.C
  src/daisy/manager/action_message.C
  src/daisy/manager/action_repeat.C
  src/daisy/manager/action_sow.C
  src/daisy/manager/action_spray.C
  src/daisy/manager/action_stop.C
  src/daisy/manager/action_surface.C
  src/daisy/manager/action_table.C
  src/daisy/manager/action_tillage.C
  src/daisy/manager/action_wait.C
  src/daisy/manager/action_while.C
  src/daisy/manager/action_with.C
  src/daisy/manager/irrigate.C
  src/daisy/organic_matter/am.C
  src/daisy/organic_matter/aom.C
  src/daisy/organic_matter/bioincorporation.C
  src/daisy/organic_matter/clayom.C
  src/daisy/organic_matter/clayom_biomod.C
  src/daisy/organic_matter/clayom_old.C
  src/daisy/organic_matter/doe.C
  src/daisy/organic_matter/dom.C
  src/daisy/organic_matter/domsorp.C
  src/daisy/organic_matter/domsorp_std.C
  src/daisy/organic_matter/om.C
  src/daisy/organic_matter/organic.C
  src/daisy/organic_matter/organic_none.C
  src/daisy/organic_matter/organic_std.C
  src/daisy/organic_matter/smb.C
  src/daisy/organic_matter/som.C
  src/daisy/output/bdconv.C
  src/daisy/output/destination.C
  src/daisy/output/dlf.C
  src/daisy/output/fetch.C
  src/daisy/output/fetch_pretty.C
  src/daisy/output/harvest.C
  src/daisy/output/log.C
  src/daisy/output/log_alist.C
  src/daisy/output/log_all.C
  src/daisy/output/log_checkpoint.C
  src/daisy/output/log_extern.C
  src/daisy/output/log_harvest.C
  src/daisy/output/log_select.C
  src/daisy/output/log_table.C
  src/daisy/output/output.C
  src/daisy/output/select.C
  src/daisy/output/select_array.C
  src/daisy/output/select_content.C
  src/daisy/output/select_flow.C
  src/daisy/output/select_index.C
  src/daisy/output/select_number.C
  src/daisy/output/select_quiver.C
  src/daisy/output/select_value.C
  src/daisy/output/select_volume.C
  src/daisy/output/summary.C
  src/daisy/output/summary_Rsqr.C
  src/daisy/output/summary_RsqrW.C
  src/daisy/output/summary_balance.C
  src/daisy/output/summary_fractiles.C
  src/daisy/output/summary_simple.C
  src/daisy/soil/abiotic.C
  src/daisy/soil/horheat.C
  src/daisy/soil/horizon.C
  src/daisy/soil/horizon_numeric.C
  src/daisy/soil/horizon_system.C
  src/daisy/soil/hydraulic.C
  src/daisy/soil/hydraulic_B_BaC.C
  src/daisy/soil/hydraulic_B_BaC_Bimodal.C
  src/daisy/soil/hydraulic_B_C.C
  src/daisy/soil/hydraulic_B_C_inverse.C
  src/daisy/soil/hydraulic_B_vG.C
  src/daisy/soil/hydraulic_Cosby.C
  src/daisy/soil/hydraulic_MACRO.C
  src/daisy/soil/hydraulic_M_BaC.C
  src/daisy/soil/hydraulic_M_BaC_Bimodal.C
  src/daisy/soil/hydraulic_M_BivG.C
  src/daisy/soil/hydraulic_M_C.C
  src/daisy/soil/hydraulic_M_vG.C
  src/daisy/soil/hydraulic_M_vG_compact.C
  src/daisy/soil/hydraulic_M_vGip.C
  src/daisy/soil/hydraulic_M_vGp.C
  src/daisy/soil/hydraulic_hypres.C
  src/daisy/soil/hydraulic_hyprop.C
  src/daisy/soil/hydraulic_linear.C
  src/daisy/soil/hydraulic_mod_C.C
  src/daisy/soil/hydraulic_old2.C
  src/daisy/soil/hydraulic_table.C
  src/daisy/soil/hydraulic_wepp.C
  src/daisy/soil/hydraulic_yolo.C
  src/daisy/soil/soil.C
  src/daisy/soil/soil_heat.C
  src/daisy/soil/soil_water.C
  src/daisy/soil/soilph.C
  src/daisy/soil/texture.C
  src/daisy/soil/tortuosity.C
  src/daisy/soil/tortuosity_M_Q.C
  src/daisy/soil/tortuosity_linear.C
  src/daisy/soil/transport/average.C
  src/daisy/soil/transport/biopore.C
  src/daisy/soil/transport/biopore_drain.C
  src/daisy/soil/transport/biopore_matrix.C
  src/daisy/soil/transport/border.C
  src/daisy/soil/transport/bound.C
  src/daisy/soil/transport/condedge.C
  src/daisy/soil/transport/drain.C
  src/daisy/soil/transport/drain_lateral.C
  src/daisy/soil/transport/draineqd.C
  src/daisy/soil/transport/geometry.C
  src/daisy/soil/transport/geometry1d.C
  src/daisy/soil/transport/geometry_rect.C
  src/daisy/soil/transport/geometry_vert.C
  src/daisy/soil/transport/heatrect.C
  src/daisy/soil/transport/heatrect_Mollerup.C
  src/daisy/soil/transport/heatrect_linear.C
  src/daisy/soil/transport/heatrect_none.C
  src/daisy/soil/transport/macro.C
  src/daisy/soil/transport/macro_none.C
  src/daisy/soil/transport/macro_std.C
  src/daisy/soil/transport/mactrans.C
  src/daisy/soil/transport/mactrans_std.C
  src/daisy/soil/transport/movement.C
  src/daisy/soil/transport/movement_1D.C
  src/daisy/soil/transport/movement_rect.C
  src/daisy/soil/transport/movement_solute.C
  src/daisy/soil/transport/secondary.C
  src/daisy/soil/transport/tertiary.C
  src/daisy/soil/transport/tertiary_biopores.C
  src/daisy/soil/transport/tertiary_old.C
  src/daisy/soil/transport/transport.C
  src/daisy/soil/transport/transport_Hansen.C
  src/daisy/soil/transport/transport_Mollerup.C
  src/daisy/soil/transport/transport_convection.C
  src/daisy/soil/transport/transport_none.C
  src/daisy/soil/transport/uz1d.C
  src/daisy/soil/transport/uz1d_none.C
  src/daisy/soil/transport/uz1d_richard.C
  src/daisy/soil/transport/uzlr.C
  src/daisy/soil/transport/uzmodel.C
  src/daisy/soil/transport/uznone.C
  src/daisy/soil/transport/uzrect.C
  src/daisy/soil/transport/uzrect_2x1.C
  src/daisy/soil/transport/uzrect_Mollerup.C
  src/daisy/soil/transport/uzrect_const.C
  src/daisy/soil/transport/uzrichard.C
  src/daisy/soil/transport/uzrichard2.C
  src/daisy/soil/transport/volume.C
  src/daisy/soil/transport/volume_box.C
  src/daisy/soil/transport/zone.C
  src/daisy/soil/transport/zone_box.C
  src/daisy/soil/transport/zone_poly.C
  src/daisy/soil/water.C
  src/daisy/timestep.C
  src/daisy/upper_boundary/bioclimate/astronomy.C
  src/daisy/upper_boundary/bioclimate/bioclimate.C
  src/daisy/upper_boundary/bioclimate/bioclimate_std.C
  src/daisy/upper_boundary/bioclimate/cloudiness.C
  src/daisy/upper_boundary/bioclimate/difrad.C
  src/daisy/upper_boundary/bioclimate/difrad_DPF.C
  src/daisy/upper_boundary/bioclimate/difrad_weather.C
  src/daisy/upper_boundary/bioclimate/fao.C
  src/daisy/upper_boundary/bioclimate/ghf.C
  src/daisy/upper_boundary/bioclimate/net_radiation.C
  src/daisy/upper_boundary/bioclimate/pet.C
  src/daisy/upper_boundary/bioclimate/pet_FAO_PM.C
  src/daisy/upper_boundary/bioclimate/pet_FAO_PM_hourly.C
  src/daisy/upper_boundary/bioclimate/pet_Hargreaves.C
  src/daisy/upper_boundary/bioclimate/pet_PM.C
  src/daisy/upper_boundary/bioclimate/pet_makkink.C
  src/daisy/upper_boundary/bioclimate/pet_weather.C
  src/daisy/upper_boundary/bioclimate/raddist.C
  src/daisy/upper_boundary/bioclimate/raddist_DPF.C
  src/daisy/upper_boundary/bioclimate/raddist_std.C
  src/daisy/upper_boundary/bioclimate/resistance.C
  src/daisy/upper_boundary/bioclimate/svat.C
  src/daisy/upper_boundary/bioclimate/svat_none.C
  src/daisy/upper_boundary/bioclimate/svat_pmsw.C
  src/daisy/upper_boundary/bioclimate/svat_ssoc.C
  src/daisy/upper_boundary/litter/litter.C
  src/daisy/upper_boundary/litter/litter_mulch.C
  src/daisy/upper_boundary/litter/litter_residue.C
  src/daisy/upper_boundary/litter/retention.C
  src/daisy/upper_boundary/surface/surface.C
  src/daisy/upper_boundary/surface/surface_simple.C
  src/daisy/upper_boundary/surface/surface_source.C
  src/daisy/upper_boundary/surface/surface_std.C
  src/daisy/upper_boundary/vegetation/vegetation.C
  src/daisy/upper_boundary/vegetation/vegetation_afforestation.C
  src/daisy/upper_boundary/vegetation/vegetation_crops.C
  src/daisy/upper_boundary/vegetation/vegetation_permanent.C
  src/daisy/upper_boundary/weather/deposition.C
  src/daisy/upper_boundary/weather/snow.C
  src/daisy/upper_boundary/weather/weather.C
  src/daisy/upper_boundary/weather/weatherdata.C
  src/daisy/upper_boundary/weather/wsource.C
  src/daisy/upper_boundary/weather/wsource_base.C
  src/daisy/upper_boundary/weather/wsource_combine.C
  src/daisy/upper_boundary/weather/wsource_const.C
  src/daisy/upper_boundary/weather/wsource_indirect.C
  src/daisy/upper_boundary/weather/wsource_std.C
  src/daisy/upper_boundary/weather/wsource_table.C
  src/daisy/upper_boundary/weather/wsource_time.C
  src/daisy/upper_boundary/weather/wsource_weather.C
  src/util/function.C
  src/gnuplot/gnuplot.C
  src/gnuplot/gnuplot_base.C
  src/gnuplot/gnuplot_multi.C
  src/gnuplot/gnuplot_profile.C
  src/gnuplot/gnuplot_soil.C
  src/gnuplot/gnuplot_time.C
  src/gnuplot/gnuplot_utils.C
  src/gnuplot/gnuplot_vector.C
  src/gnuplot/gnuplot_xy.C
  src/gnuplot/program_gnuplot.C
  src/gnuplot/source.C
  src/gnuplot/source_combine.C
  src/gnuplot/source_expr.C
  src/gnuplot/source_file.C
  src/gnuplot/source_merge.C
  src/gnuplot/source_std.C
  src/gnuplot/xysource.C
  src/gnuplot/xysource_combine.C
  src/gnuplot/xysource_expr.C
  src/gnuplot/xysource_flux.C
  src/gnuplot/xysource_freq.C
  src/gnuplot/xysource_inline.C
  src/gnuplot/xysource_loop.C
  src/gnuplot/xysource_merge.C
  src/gnuplot/xysource_profile.C
  src/gnuplot/xysource_xycombine.C
  src/object_model/attribute.C
  src/object_model/block.C
  src/object_model/block_model.C
  src/object_model/block_nested.C
  src/object_model/block_submodel.C
  src/object_model/block_top.C
  src/object_model/check.C
  src/object_model/check_range.C
  src/object_model/convert.C
  src/object_model/frame.C
  src/object_model/frame_model.C
  src/object_model/frame_submodel.C
  src/object_model/intrinsics.C
  src/object_model/librarian.C
  src/object_model/library.C
  src/object_model/metalib.C
  src/object_model/model.C
  src/object_model/model_derived.C
  src/object_model/model_framed.C
  src/object_model/model_logable.C
  src/object_model/oldunits.C
  src/object_model/parser.C
  src/object_model/parser_file.C
  src/object_model/plf.C
  src/object_model/printer.C
  src/object_model/printer_file.C
  src/object_model/rate.C
  src/object_model/symbol.C
  src/object_model/toplevel.C
  src/object_model/traverse.C
  src/object_model/traverse_delete.C
  src/object_model/treelog.C
  src/object_model/treelog_child.C
  src/object_model/treelog_store.C
  src/object_model/treelog_text.C
  src/object_model/type.C
  src/object_model/unit.C
  src/object_model/unit_model.C
  src/object_model/units.C
  src/object_model/value.C
  src/object_model/vcheck.C
  src/object_model/version.C
  src/object_model/xref.C
  src/parameter_types/boolean.C
  src/parameter_types/boolean_number.C
  src/parameter_types/boolean_string.C
  src/parameter_types/integer.C
  src/parameter_types/integer_arit.C
  src/parameter_types/number.C
  src/parameter_types/number_arit.C
  src/parameter_types/number_const.C
  src/parameter_types/number_lisp.C
  src/parameter_types/number_plf.C
  src/parameter_types/number_soil.C
  src/parameter_types/number_source.C
  src/parameter_types/stringer.C
  src/programs/program.C
  src/programs/program_GP2D.C
  src/programs/program_KM2.C
  src/programs/program_batch.C
  src/programs/program_cpedata.C
  src/programs/program_document.C
  src/programs/program_extract.C
  src/programs/program_file.C
  src/programs/program_hmovie.C
  src/programs/program_nwaps.C
  src/programs/program_optimize.C
  src/programs/program_osvaldo.C
  src/programs/program_post.C
  src/programs/program_rootmatch.C
  src/programs/program_sbrdata.C
  src/programs/program_spawn.C
  src/programs/program_weather.C
  src/ui/main.C
  src/ui/run.C
  src/ui/ui.C
  src/ui/uifilter.C
  src/util/anystate.C
  src/util/assertion.C
  src/util/complex_functions.C
  src/util/depth.C
  src/util/filepos.C
  src/util/format.C
  src/util/format_LaTeX.C
  src/util/gaussj.C
  src/util/hyp_2F1.C
  src/util/iterative.C
  src/util/lexer.C
  src/util/lexer_data.C
  src/util/lexer_flux.C
  src/util/lexer_soil.C
  src/util/lexer_table.C
  src/util/mathlib.C
  src/util/nrutil.C
  src/util/path.C
  src/util/point.C
  src/util/scope.C
  src/util/scope_exchange.C
  src/util/scope_id.C
  src/util/scope_model.C
  src/util/scope_multi.C
  src/util/scope_soil.C
  src/util/scope_sources.C
  src/util/scope_table.C
  src/util/scope_xysources.C
  src/util/scopesel.C
  src/util/solver.C
  src/util/solver_cxsparse.C
  src/util/solver_none.C
  src/util/solver_ublas.C
)

target_include_directories(daisy PUBLIC include)

target_link_directories(daisy INTERFACE Boost::Boost)

target_link_libraries(daisy PUBLIC
  stdc++
  ${Boost_LIBRARIES}
  cxsparse
  dl
  pthread
)


set(RELEASE_COMPILE_OPTIONS
  -ffast-math
  -fno-finite-math-only
  -mtune=native
  -march=native
) 
target_compile_options(daisy PRIVATE
  "$<$<CONFIG:RELEASE>:${RELEASE_COMPILE_OPTIONS}>"
)
